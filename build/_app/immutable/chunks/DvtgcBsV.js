var u=Object.defineProperty;var g=(s,a,e)=>a in s?u(s,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[a]=e;var d=(s,a,e)=>g(s,typeof a!="symbol"?a+"":a,e);import{d as E,b as l}from"./K6YgHZ2F.js";class h{constructor(){d(this,"cache",new Map);d(this,"defaultTTL",5*60*1e3)}set(a,e,o=this.defaultTTL){this.cache.set(a,{data:e,timestamp:Date.now(),ttl:o})}get(a){const e=this.cache.get(a);return e?Date.now()-e.timestamp>e.ttl?(this.cache.delete(a),null):e.data:null}clear(){this.cache.clear()}delete(a){this.cache.delete(a)}}class A{constructor(){d(this,"cache",new h);d(this,"baseUrl","/tipos-epi")}async getTiposEPI(a={}){console.log("üìã CatalogAdapter: Carregando tipos de EPI do backend real",a);const e=`tipos-epi-${JSON.stringify(a)}`,o=this.cache.get(e);if(o)return console.log("üíæ Cache hit para tipos EPI"),o;try{const t={page:a.page||1,limit:a.pageSize||10,...a.search&&{search:a.search},...a.categoria&&{categoria:a.categoria},...a.ativo!==void 0&&{ativo:a.ativo}},r=E("/tipos-epi",t),i=await l.get(r);console.log("üîó Resposta da API tipos-epi:",i);const n=i.data.items.map(c=>({id:c.id,nomeEquipamento:c.nomeEquipamento,numeroCa:c.numeroCa,numeroCA:c.numeroCa,categoria:c.categoria,status:c.status||"ATIVO",vidaUtilDias:c.vidaUtilDias,validadePadrao:c.vidaUtilDias,descricao:c.descricao||"",ativo:c.status==="ATIVO",createdAt:c.createdAt,updatedAt:c.updatedAt,dataCriacao:c.createdAt,dataAtualizacao:c.updatedAt||c.createdAt})),p={data:n,total:i.data.pagination.total,page:i.data.pagination.page,pageSize:i.data.pagination.limit,totalPages:i.data.pagination.totalPages};return this.cache.set(e,p),console.log("‚úÖ Tipos EPI carregados do backend real:",n.length,"itens"),p}catch(t){throw console.error("‚ùå Erro ao carregar tipos EPI do backend:",t),new Error("N√£o foi poss√≠vel carregar o cat√°logo de EPIs do backend")}}async getTipoEPIById(a){console.log("üîç CatalogAdapter: Buscando tipo EPI do backend real",a);const e=`tipo-epi-${a}`,o=this.cache.get(e);if(o)return o;try{const t=`/tipos-epi/${a}`,r=await l.get(t);console.log("üîó Resposta da API tipo-epi espec√≠fico:",r);const i=r.data,n={id:i.id,nomeEquipamento:i.nomeEquipamento,numeroCa:i.numeroCa,numeroCA:i.numeroCa,categoria:i.categoria,status:i.status||"ATIVO",vidaUtilDias:i.vidaUtilDias,validadePadrao:i.vidaUtilDias,descricao:i.descricao||"",ativo:i.status==="ATIVO",createdAt:i.createdAt,updatedAt:i.updatedAt,dataCriacao:i.createdAt,dataAtualizacao:i.updatedAt||i.createdAt};return this.cache.set(e,n),console.log("‚úÖ Tipo EPI espec√≠fico carregado do backend real"),n}catch(t){throw console.error("‚ùå Erro ao buscar tipo EPI do backend:",t),new Error("N√£o foi poss√≠vel buscar o tipo de EPI do backend")}}async createTipoEPI(a){console.log("‚ûï CatalogAdapter: Criando tipo EPI no backend real",a);try{const e={nomeEquipamento:a.nomeEquipamento,numeroCa:a.numeroCa,categoria:a.categoria,vidaUtilDias:a.vidaUtilDias,descricao:a.descricao,status:"ATIVO"},o=await l.post("/tipos-epi",e);console.log("üîó Resposta da cria√ß√£o no backend:",o);const t=o.data,r={id:t.id,nomeEquipamento:t.nomeEquipamento,numeroCa:t.numeroCa,numeroCA:t.numeroCa,categoria:t.categoria,status:t.status||"ATIVO",vidaUtilDias:t.vidaUtilDias,validadePadrao:t.vidaUtilDias,descricao:t.descricao||"",ativo:t.status==="ATIVO",createdAt:t.createdAt,updatedAt:t.updatedAt,dataCriacao:t.createdAt,dataAtualizacao:t.updatedAt||t.createdAt};return this.cache.clear(),console.log("‚úÖ Tipo EPI criado com sucesso no backend:",r.id),r}catch(e){throw console.error("‚ùå Erro ao criar tipo EPI no backend:",e),new Error("N√£o foi poss√≠vel criar o tipo de EPI")}}async updateTipoEPI(a,e){console.log("üìù CatalogAdapter: Atualizando tipo EPI no backend real",a,e);try{const o={};e.nomeEquipamento&&(o.nomeEquipamento=e.nomeEquipamento),e.numeroCa&&(o.numeroCa=e.numeroCa),e.categoria&&(o.categoria=e.categoria),e.vidaUtilDias&&(o.vidaUtilDias=e.vidaUtilDias),e.descricao!==void 0&&(o.descricao=e.descricao),e.ativo!==void 0&&(o.status=e.ativo?"ATIVO":"DESCONTINUADO");const t=await l.put(`/tipos-epi/${a}`,o);console.log("üîó Resposta da atualiza√ß√£o no backend:",t);const r=t.data,i={id:r.id,nomeEquipamento:r.nomeEquipamento,numeroCa:r.numeroCa,numeroCA:r.numeroCa,categoria:r.categoria,status:r.status||"ATIVO",vidaUtilDias:r.vidaUtilDias,validadePadrao:r.vidaUtilDias,descricao:r.descricao||"",ativo:r.status==="ATIVO",createdAt:r.createdAt,updatedAt:r.updatedAt,dataCriacao:r.createdAt,dataAtualizacao:r.updatedAt||r.createdAt};return this.cache.delete(`tipo-epi-${a}`),this.cache.clear(),console.log("‚úÖ Tipo EPI atualizado com sucesso no backend"),i}catch(o){throw console.error("‚ùå Erro ao atualizar tipo EPI no backend:",o),new Error("N√£o foi poss√≠vel atualizar o tipo de EPI")}}async deleteTipoEPI(a){console.log("üóëÔ∏è CatalogAdapter: Removendo tipo EPI no backend real",a);try{await this.updateTipoEPI(a,{ativo:!1}),console.log("‚úÖ Tipo EPI removido com sucesso no backend")}catch(e){throw console.error("‚ùå Erro ao remover tipo EPI no backend:",e),new Error("N√£o foi poss√≠vel remover o tipo de EPI")}}clearCache(){this.cache.clear(),console.log("üóëÔ∏è Cache do cat√°logo limpo")}async getFilterOptions(){try{const a=await this.getTiposEPI({pageSize:100});a.data&&a.data.length>=100&&console.warn("‚ö†Ô∏è Mais de 100 tipos de EPI encontrados. Filtros podem estar incompletos.");const e=[...new Set(a.data.map(o=>o.categoria))].filter(Boolean).sort().map(o=>({value:o,label:o}));return console.log("‚úÖ Op√ß√µes de filtros carregadas:",{categorias:e.length}),{categorias:e}}catch(a){return console.error("‚ùå Erro ao carregar op√ß√µes de filtros:",a),{categorias:[]}}}}const v=new A;export{v as c};
